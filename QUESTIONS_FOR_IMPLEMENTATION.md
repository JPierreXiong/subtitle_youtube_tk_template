# 实施前需要澄清的问题清单

## 📋 说明
本文档列出了在执行功能改进方案前需要澄清的所有问题。这些问题旨在确保：
1. 不破坏ShipAny的现有软件结构
2. 明确技术实现细节
3. 了解现有基础设施和限制
4. 确保方案可行性和兼容性

---

## 一、现有系统架构相关问题

### 1.1 视频处理后端实现

**问题1**: `/api/media/submit/route.ts` 文件目前是空的，实际的视频提取和字幕生成逻辑在哪里实现？
- [ ] 是否有独立的后端服务/Worker处理视频任务？
- [ ] 是否使用第三方API服务（如Replicate、Fal等）来处理视频？
- [ ] 视频处理是在Next.js API路由中同步执行，还是异步队列处理？
- [ ] 如果使用异步处理，使用的是什么队列系统（如BullMQ、Bull、RabbitMQ等）？

**问题2**: YouTube和TikTok视频的下载和元数据提取使用什么技术栈？
- [ ] 是否使用 `yt-dlp` 或类似工具？
- [ ] 是否使用YouTube Data API v3来获取元数据？
- [ ] TikTok是否有官方API，还是使用第三方库？
- [ ] 这些工具/API是在服务器端运行，还是通过外部服务调用？

**问题3**: 字幕提取使用什么技术？
- [ ] 是否使用语音识别API（如Whisper、Google Speech-to-Text）？
- [ ] 是否直接使用YouTube/TikTok提供的字幕文件？
- [ ] 字幕提取是实时处理还是异步处理？

---

## 二、数据库和存储相关问题

### 2.1 数据库迁移

**问题4**: 数据库迁移流程是什么？
- [ ] 使用什么迁移工具（Drizzle Kit、Prisma Migrate等）？
- [ ] 是否可以直接修改 `schema.ts` 然后运行迁移命令？
- [ ] 生产环境的迁移流程是什么？是否需要手动执行SQL？

**问题5**: Neon数据库的限制
- [ ] 是否有字段大小限制（TEXT字段最大长度）？
- [ ] 是否有存储容量限制？
- [ ] 是否需要考虑字幕文本长度对性能的影响？

### 2.2 存储服务配置

**问题6**: 当前存储服务配置
- [ ] R2或S3是否已经配置并可用？
- [ ] 存储桶名称是什么？
- [ ] 是否已经配置了CDN域名？
- [ ] 存储服务的访问密钥是否已经配置在环境变量中？

**问题7**: 存储服务生命周期策略
- [ ] 是否可以在R2/S3中配置自动删除策略？
- [ ] 是否有权限配置存储桶生命周期规则？
- [ ] 如果使用预签名URL，URL有效期最长可以设置多久？

---

## 三、API和服务集成相关问题

### 3.1 Gemini API集成

**问题8**: Gemini API配置
- [ ] 是否已经有Google Cloud账号和API密钥？
- [ ] 是否需要在Google Cloud Console中启用Gemini API？
- [ ] API密钥的权限和配额限制是什么？
- [ ] 是否需要考虑API调用频率限制？

**问题9**: Gemini API替代方案
- [ ] 如果Gemini API不可用，是否有备选翻译方案？
- [ ] 是否可以使用现有的OpenRouter服务进行翻译？
- [ ] 是否需要保留Google翻译API作为降级方案？

### 3.2 视频元数据提取API

**问题10**: YouTube元数据提取
- [ ] 是否已经有YouTube Data API v3的API密钥？
- [ ] API配额限制是多少（每日请求数）？
- [ ] 是否需要处理API配额超限的情况？

**问题11**: TikTok元数据提取
- [ ] TikTok是否有官方API可以获取元数据？
- [ ] 如果没有官方API，使用什么方法获取点赞、播放量等数据？
- [ ] 是否需要处理反爬虫机制？

---

## 四、UI/UX实现相关问题

### 4.1 UI布局和交互

**问题12**: UI组件库
- [ ] 当前使用的UI组件库是什么（看起来是shadcn/ui）？
- [ ] 是否可以自由修改组件样式和布局？
- [ ] 是否需要保持与ShipAny其他页面的一致性？

**问题13**: 国际化（i18n）
- [ ] 所有文本是否都需要支持多语言？
- [ ] 新增的UI文本需要添加到哪些语言文件？
- [ ] 默认语言是英语，但用户界面语言如何确定？

**问题14**: 按钮布局细节
- [ ] "3个按钮"是指3个独立的按钮组件，还是3个选择器（Select）？
- [ ] 第一个按钮（母语）是否始终显示，还是在检测到语言后才显示？
- [ ] "只有选择下载时才显示下载按钮" - 这里的"下载"是指选择"video"输出类型吗？

### 4.2 进度条和Loading

**问题15**: 进度更新机制
- [ ] 后端如何实时更新任务进度（0-100%）？
- [ ] 是否需要在后端处理逻辑中手动更新进度，还是由处理服务自动更新？
- [ ] 进度更新的粒度是什么（每10%？每阶段？）？

**问题16**: Loading动效
- [ ] 是否有现有的Loading组件可以使用？
- [ ] 是否需要使用Framer Motion，还是使用CSS动画即可？
- [ ] 是否有性能考虑（避免影响页面性能）？

---

## 五、业务流程相关问题

### 5.1 两阶段翻译流程

**问题17**: 翻译触发时机
- [ ] 第一阶段完成后，翻译语言选择是自动弹出，还是需要用户主动操作？
- [ ] 如果用户不选择翻译语言，是否只提供原生SRT下载？
- [ ] 用户是否可以在任何时候选择翻译，还是必须在第一阶段完成后立即选择？

**问题18**: 翻译状态管理
- [ ] 如果用户在第一阶段完成后选择翻译，任务状态如何变化？
  - 选项A: 创建新的任务记录
  - 选项B: 更新现有任务记录，添加翻译状态
- [ ] 翻译失败时，原生SRT是否仍然可用？

### 5.2 视频下载流程

**问题19**: TikTok视频下载
- [ ] 视频下载是直接返回文件流，还是先上传到存储再返回URL？
- [ ] 下载的视频是否需要添加水印或其他处理？
- [ ] 如果视频下载失败，如何处理？

**问题20**: 视频暂存策略
- [ ] 24小时是从任务创建时间开始计算，还是从视频下载完成时间开始？
- [ ] 如果用户在24小时内多次下载，是否需要延长过期时间？
- [ ] 视频文件删除后，数据库记录如何处理（保留记录但清空URL？）？

---

## 六、数据导出相关问题

### 6.1 CSV导出功能

**问题21**: 导出数据范围
- [ ] CSV导出是导出当前用户的所有任务，还是可以选择时间范围？
- [ ] 是否需要支持筛选（按平台、状态、日期等）？
- [ ] 导出文件大小是否有限制？

**问题22**: 导出功能位置
- [ ] CSV导出按钮放在哪里？
  - 选项A: 媒体提取页面
  - 选项B: 用户任务列表页面（Activity页面）
  - 选项C: 用户设置页面
- [ ] 是否需要权限控制（只有特定用户角色可以导出）？

**问题23**: 数据格式
- [ ] 字幕文本在CSV中如何格式化（换行符处理）？
- [ ] 是否需要支持导出为其他格式（JSON、Excel等）？
- [ ] 日期时间格式使用什么标准（ISO 8601？）？

---

## 七、性能和限制相关问题

### 7.1 处理时间和超时

**问题24**: 处理时间估算
- [ ] "约3分钟"是基于什么视频长度估算的？
- [ ] 是否需要根据视频长度动态调整超时时间？
- [ ] 如果处理时间超过3分钟，如何处理？

**问题25**: 并发处理限制
- [ ] 同一用户是否可以同时处理多个任务？
- [ ] 系统是否有全局并发限制？
- [ ] 是否需要实现任务队列来管理并发？

### 7.2 文件大小限制

**问题26**: 视频文件大小
- [ ] 是否有视频文件大小限制？
- [ ] 长视频（>1小时）是否支持处理？
- [ ] 字幕文件大小是否有限制？

---

## 八、错误处理和用户体验

### 8.1 错误处理

**问题27**: 错误场景处理
- [ ] 如果视频URL无效或视频不存在，如何提示用户？
- [ ] 如果视频没有字幕，如何处理？
- [ ] 如果翻译API失败，是否提供降级方案？
- [ ] 如果存储服务不可用，如何处理？

**问题28**: 积分扣除
- [ ] 如果任务失败，积分是否退还？
- [ ] 积分是在任务提交时扣除，还是任务完成时扣除？
- [ ] 两阶段翻译的积分如何计算（第一阶段10积分，翻译5积分？）？

### 8.2 用户体验

**问题29**: 用户反馈
- [ ] 是否需要提供任务取消功能？
- [ ] 是否需要提供任务重试功能？
- [ ] 是否需要显示任务历史记录？

---

## 九、安全和合规相关问题

### 9.1 数据安全

**问题30**: 数据隐私
- [ ] 视频URL和字幕文本是否需要加密存储？
- [ ] 是否有数据保留策略（超过一定时间自动删除）？
- [ ] 用户数据导出是否符合GDPR等隐私法规要求？

**问题31**: API安全
- [ ] API密钥如何安全存储？
- [ ] 是否需要实现API调用频率限制？
- [ ] 是否需要实现用户级别的API配额？

### 9.2 内容合规

**问题32**: 内容审核
- [ ] 是否需要审核下载的视频内容？
- [ ] 是否需要过滤不当内容？
- [ ] 如何处理版权问题？

---

## 十、ShipAny框架特定问题

### 10.1 框架结构

**问题33**: 扩展点
- [ ] ShipAny是否有特定的扩展点来添加新功能？
- [ ] 是否需要在 `extensions` 目录下创建新的扩展？
- [ ] 是否需要遵循特定的代码组织规范？

**问题34**: 配置管理
- [ ] 新增的配置项（如Gemini API密钥）应该放在哪里？
  - 选项A: 环境变量
  - 选项B: 数据库config表
  - 选项C: 两者都支持
- [ ] 是否需要添加到管理后台的设置页面？

**问题35**: 任务系统
- [ ] ShipAny是否有统一的任务管理系统？
- [ ] `mediaTasks` 表是否应该遵循与 `aiTask` 表相同的模式？
- [ ] 是否需要实现类似AI任务的通知回调机制？

---

## 十一、测试和部署相关问题

### 11.1 测试环境

**问题36**: 测试数据
- [ ] 是否有测试用的YouTube/TikTok视频URL？
- [ ] 测试环境是否有API密钥配额限制？
- [ ] 是否需要Mock外部API服务进行测试？

**问题37**: 部署流程
- [ ] 代码修改后如何部署到生产环境？
- [ ] 数据库迁移是否需要手动执行？
- [ ] 是否需要回滚方案？

---

## 十二、优先级和范围问题

### 12.1 功能优先级

**问题38**: MVP范围
- [ ] 哪些功能是必须的（MVP），哪些可以后续添加？
- [ ] 如果时间有限，哪些功能可以简化实现？
- [ ] 是否有功能可以暂时使用简化版本？

**问题39**: 兼容性
- [ ] 新功能是否需要向后兼容现有数据？
- [ ] 是否需要支持迁移现有任务数据？
- [ ] 如果用户已有未完成的任务，如何处理？

---

## 总结

### 关键问题（必须回答）

以下问题必须在开始实施前明确：

1. **问题1**: 视频处理后端实现方式
2. **问题2**: YouTube/TikTok视频下载和元数据提取技术栈
3. **问题3**: 字幕提取技术
4. **问题8**: Gemini API配置和可用性
5. **问题12**: UI布局的具体要求
6. **问题17**: 两阶段翻译流程的具体交互
7. **问题33**: ShipAny框架的扩展规范

### 建议

1. **先确认核心问题**: 优先回答"关键问题"部分，这些决定了整体架构
2. **逐步细化**: 其他问题可以在实施过程中逐步明确
3. **保持灵活性**: 对于不确定的问题，建议采用可扩展的设计，便于后续调整

---

## 下一步行动

1. 请逐一回答上述问题
2. 对于不确定的问题，请说明当前的理解或假设
3. 对于需要技术调研的问题，请说明调研计划
4. 确认后，我将根据答案调整实施方案并开始编码


